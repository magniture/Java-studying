# 容器网络
## 映射容器
```shell

# 指定映射
docker run -dit --name nginxweb1 -p 8081:80 nginx

# 随机映射
docker run -dit --name nginxweb4 -P nginx

# 查看所有容器
docker ps -a
```
## 主机网络
可以使用 --network=host 参数来直接使用宿主机网络
```shell
[root@10-7-136-81 ~]# docker run -dit --network=host --name nginx-host nginx
258f90709a763714e4301d3769ff011ff8307cb9f7f9252c1c903cc49d702190
[root@10-7-136-81 ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                 NAMES
258f90709a76   nginx       "/docker-entrypoint.…"   21 seconds ago   Up 20 seconds                         nginx-host
cf7e92c8eca5   nginx       "/docker-entrypoint.…"   16 hours ago     Up 16 hours     80/tcp                nginx_name
ec3b9b1f3892   nginx       "/docker-entrypoint.…"   16 hours ago     Up 16 hours     80/tcp                intelligent_nobel
9d97e35745a6   mysql:5.7   "docker-entrypoint.s…"   16 hours ago     Up 16 hours     3306/tcp, 33060/tcp   heuristic_chatelet

```
## 容器互联
### 新建网桥
-d 参数指定 Docker 网络类型，有 bridge overlay 。其中 overlay 网络 类型用于 Swarm mode，在本小节中你可以忽略它。
```shell
docker network create -d bridge new-net
```
### 容器互联创建容器
```shell
docker run -dit --name box1 --network new-net busybox
docker run -dit --name box2 --network new-net busybox
```
###  容器互联测试
```shell
# 进入box1容器
docker exec -it box1 sh

# ping测试
ping box2
```
```shell
# 测试结果
[root@10-7-136-81 ~]# docker network create -d bridge new-net
782d02855d387a12e7f26ae60031428993dd515c6810bccd94cc1ee1fc5058bf
[root@10-7-136-81 ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED              STATUS              PORTS                 NAMES
258f90709a76   nginx       "/docker-entrypoint.…"   About a minute ago   Up About a minute                         nginx-host
cf7e92c8eca5   nginx       "/docker-entrypoint.…"   16 hours ago         Up 16 hours         80/tcp                nginx_name
ec3b9b1f3892   nginx       "/docker-entrypoint.…"   16 hours ago         Up 16 hours         80/tcp                intelligent_nobel
9d97e35745a6   mysql:5.7   "docker-entrypoint.s…"   16 hours ago         Up 16 hours         3306/tcp, 33060/tcp   heuristic_chatelet
[root@10-7-136-81 ~]# docker run -dit --name box1 --network new-net busybox
Unable to find image 'busybox:latest' locally
latest: Pulling from library/busybox
22b70bddd3ac: Pull complete 
Digest: sha256:6bdd92bf5240be1b5f3bf71324f5e371fe59f0e153b27fa1f1620f78ba16963c
Status: Downloaded newer image for busybox:latest
485207db416c1b18b0316fde897ae53a0de1f631a55d655addb8f6f7d809abca
[root@10-7-136-81 ~]# docker run -dit --name box2 --network new-net busybox
7ca5d1c8c6ea8af9cf20b8dbfbfb523d648bd2157a6fbad11cdac74b51129f7c
[root@10-7-136-81 ~]# docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
mysql        5.7       eef0fab001e8   4 days ago    495MB
busybox      latest    bc01a3326866   2 weeks ago   1.24MB
nginx        latest    76c69feac34e   2 weeks ago   142MB
redis        latest    c2342258f8ca   2 weeks ago   117MB
[root@10-7-136-81 ~]# docker exec -it box1 sh
/ # ping box2
PING box2 (172.18.0.3): 56 data bytes
64 bytes from 172.18.0.3: seq=0 ttl=64 time=0.104 ms
64 bytes from 172.18.0.3: seq=1 ttl=64 time=0.134 ms
64 bytes from 172.18.0.3: seq=2 ttl=64 time=0.135 ms
64 bytes from 172.18.0.3: seq=3 ttl=64 time=0.132 ms
64 bytes from 172.18.0.3: seq=4 ttl=64 time=0.121 ms
64 bytes from 172.18.0.3: seq=5 ttl=64 time=0.097 ms
64 bytes from 172.18.0.3: seq=6 ttl=64 time=0.160 ms
64 bytes from 172.18.0.3: seq=7 ttl=64 time=0.136 ms

```
## 自定义docker0网络
### 移除原有网络，安装btctl命令
```shell
yum install -y bridge-utils
```
### 查询网桥信息
```shell
brctl  show
```
### 关闭docker服务
```shell
systemctl stop docker
```

### 停止docker0网桥
```shell
ip link set dev docker0 down
```
### 删除docker0网桥
```shell
brctl delbr docker0
```
### 查询所有网桥信息
```shell
brctl show
```

## 自定义新网络
### 创建新网桥
```shell
brctl addbr bridge0
```
### 查询创建的bridge0
```shell
brctl show
```
### 设置新网桥的网络段地址
```shell
ip addr add 192.168.0.1/24 dev bridge0
```
### 启动bridge0网桥
```shell
ip link set dev bridge0 up
```
### 查询bridge0网桥信息
```shell
ifconfig bridge0
```
### 添加新网桥到配置文件
```shell
vi /etc/sysconfig/docker
# 添加 -b=bridge0 到 OPTIONS 中
OPTIONS='-b=bridge0'
```
### 加载配置文件，重启docker
```shell
systemctl daemon-reload
systemctl restart docker
```
## 使用新网络部署应用测试docker0网络
### 创建一个nginx容器
```shell
docker run -dit --name nginx-net nginx
```
### 查看容器的状态
```shell
docker ps -a
```